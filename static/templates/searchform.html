<!DOCTYPE html>
 <html>
   <head>
      <title>ClubHub.com</title>
   </head>
   <body>
      <style>
         .scrollable-menu-dropdown {
            height: auto;
            max-height: 200px;
            overflow-x: hidden;
         }
         td {
            border-collapse: collapse;
            padding: 2rem;
         }
      </style>
         <h1>Club Search</h1>
         <form action = "/searchresults" method="get">
               Search for clubs:<br>
            <!---<button type="submit"><i class="fa fa-search"></i></button> --->
            <input type="text" placeholder="Search for clubs, keywords..." name="clubquery" value="{{clubquery}}">
            <input type="submit" value="Go">
            <div style="padding-top:8px;">
               <button class="btn-info dropdown-toggle" type="button" data-bs-toggle="dropdown" data-toggle="dropdown"aria-expanded="false">
                  Search With Tags 
               </button> 

               <script>
                  let tags_selection = ['Academic','A Cappella','Advocacy & Activism', 'Arts','Career Opportunity','Chaplaincies',
                  'Cultural/Identity','Dance','Dialogues & Partnerships','Educational','Entrepreneurship/Innovation','Environmental',
                  'Finance','Financial Literacy','Food','Games','Health','Media','Music','Performing Arts','Political','Professional',
                  'Publication','Racial Justice','Religious','Service','Social','Social Justice','Special Interest','Sports/Recreation',
                  'Student Government','Sustained Volunteering'];
                  let tags_tf = [];
                  for (let i = 0; i < tags_selection.length; i++){
                     tags_tf[i] = false;
                  }
               </script>

               Finder:<div id = 'finder'></div>

               <div id = "selected_tags" name ="selected_tags" value = {{selected_tags}}>
                  {%for tag in tags:%}
                     {% if tag[0] in checked: %}
                     <div id = 'comma'></div>
                        <script>
                           const findInd = (element) => element == '{{tag[0]}}';
                           tags_tf[tags_selection.findIndex(findInd)] = true;
                           document.getElementById('finder').innerHTML = tags_tf[0];
                           
                           toggle('');




                           
                           function toggle(tag) {
                              checkbox = document.getElementById(tag);
                              checkbox.checked = !checkbox.checked;
                              const findInd = (element) => element == tag;
                              if (checkbox.checked){
                                 tags_tf[tags_selection.findIndex(findInd)] = true;
                              }
                              else{
                                 tags_tf[tags_selection.findIndex(findInd)] = false;
                              }
                              let htmlBuilder = "";
                              selected_tags = get_selected_tags();
                              for (let i = 0; i < selected_tags.length; i++){
                                 htmlBuilder += selected_tags[i];
                                 if (selected_tags.length - i > 1)
                                    htmlBuilder += ', ';
                              }
                              document.getElementById('selected_tags').innerHTML = htmlBuilder;
                           }

                           function get_selected_tags(){
                              let selected_tags = [];
                              // append all selected tags
                              for (let i = 0; i < tags_selection.length; i++){
                                 if (tags_tf[i]) {
                                    selected_tags.push(tags_selection[i]);
                                 }
                              }
                              return selected_tags
                           }






                        </script>
                     {% endif%}
                  {%endfor%}
               </div>
              

               <!--SEARCH WITH TAGS-->
               <ul id="tagdropdown" class="dropdown-menu scrollable-menu-dropdown">
                  {% for tag in tags: %}
                  <li onClick="toggle('{{tag[0]}}')">
                     <a class="dropdown-item">
                        <label>{{tag[0]}}</label>
                        {% if tag[0] in checked: %}
                        <input type="checkbox" checked name="tags" id='{{tag[0]}}' value='{{tag[0]}}' onClick="toggle('{{tag[0]}}')">
                        {% else: %}
                        <input type="checkbox" name="tags" id='{{tag[0]}}' value='{{tag[0]}}' onClick="toggle('{{tag[0]}}')">
                        {% endif %}
                     </a>
                  </li>
                  {% endfor %}
               </ul>
            </div>
         </form>

         <!--SUBSCRIBE TO TAGS DROPDOWN-->
         <div style="padding-top:8px;">
            <button class="btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" data-toggle="dropdown"aria-expanded="false">Subscribe To Tags</button>

            <ul id="tagdropdown" class="dropdown-menu scrollable-menu-dropdown">
               <li><a class="dropdown-item" style="color:red; font-size:x-small;">*Subscribing to a tag will subscribe you to all clubs containing the specified tag.</a></li>
               {% for tag in tags: %}
               <li onClick="sub_tag('{{tag[0]}}')">
                  <a class="dropdown-item" style="white-space:normal;">
                     <label for={{tag[0]}}>{{tag[0]}}</label>
                  </a>
               </li>
               {% endfor %}
            </ul>

            <script>
               document.getElementById("tagdropdown").addEventListener("click", function(e) {
                  e.stopPropagation();
               });

               function toggle(tag) {
                  checkbox = document.getElementById(tag);
                  checkbox.checked = !checkbox.checked;
                  const findInd = (element) => element == tag;
                  if (checkbox.checked){
                     tags_tf[tags_selection.findIndex(findInd)] = true;
                  }
                  else{
                     tags_tf[tags_selection.findIndex(findInd)] = false;
                  }
                  let htmlBuilder = "";
                  selected_tags = get_selected_tags();
                  for (let i = 0; i < selected_tags.length; i++){
                     htmlBuilder += selected_tags[i];
                     if (selected_tags.length - i > 1)
                        htmlBuilder += ', ';
                  }
                  document.getElementById('selected_tags').innerHTML = htmlBuilder;
               }

               function get_selected_tags(){
                  let selected_tags = [];
                  // append all selected tags
                  for (let i = 0; i < tags_selection.length; i++){
                     if (tags_tf[i]) {
                        selected_tags.push(tags_selection[i]);
                     }
                  }
                  return selected_tags
               }

               function sub_tag(tag) {
                  fetch("/subscribe_tag?tag="+encodeURIComponent(tag)+"&subscribe_tag=1")
                  .then((response) => response.text())
                  .then((text) => {
                     if (text=="success"){
                        alert("Successfully subscribed to tag " + tag + "!")
                     }
                     else alert("Error - unable to subscribe to tag " + tag)
                  });
               }
               
            </script>
         </div>
         <!--Split Screen-->

      <!---Keep the JS below at the bottom of body. For loading bootstrap-->
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js" integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk" crossorigin="anonymous"></script>
      <script type="text/javascript" src="Scripts/jquery-2.1.1.min.js"></script>
   </body>
 </html>